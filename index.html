<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Edit (Smart) for Photopea</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <img src="icon.png" alt="icon" />
      <h1>AI Edit (Smart)</h1>
    </header>

    <section class="prompt">
      <label for="prompt">Prompt</label>
      <textarea id="prompt" rows="3" placeholder="مثال: ازالة الكأس من الطاولة // استبدل الهاتف بآيفون أسود // أضف فنجان قهوة"></textarea>
      <div class="row">
        <label><input type="checkbox" id="autoIntent" checked /> Auto-detect intent (Remove / Replace / Generate)</label>
        <span id="intentBadge" class="badge">mode: auto</span>
      </div>
    </section>

    <section class="io">
      <div class="col">
        <h3>Connection</h3>
        <label>Serverless endpoint (recommended)</label>
        <input id="serverUrl" placeholder="https://your-worker.example.com/edit" />
        <div class="or">— or —</div>
        <label>OpenAI API Key (client-side)</label>
        <input id="apiKey" type="password" placeholder="sk-..." />
        <div class="hint">If both are supplied, serverless is used.</div>
      </div>
      <div class="col">
        <h3>Mask</h3>
        <div class="tools">
          <button id="fetchImage">Fetch image from Photopea</button>
          <label>Brush: <input id="brushSize" type="range" min="3" max="80" value="28"/></label>
          <label><input type="checkbox" id="erase"> Erase</label>
          <button id="clearMask">Clear mask</button>
        </div>
        <div class="canvasWrap">
          <canvas id="imgCanvas"></canvas>
          <canvas id="maskCanvas"></canvas>
        </div>
        <div class="hint">Paint over the area you want to edit. Painted area = will be edited.</div>
      </div>
    </section>

    <section class="actions">
      <button id="run">Run</button>
      <button id="openResult">Open Result in Photopea (if downloaded)</button>
      <span id="status"></span>
    </section>

    <footer>
      <details>
        <summary>How it works</summary>
        <ul>
          <li>Fetch flattened PNG via <code>saveToOE('png')</code>.</li>
          <li>Create transparent PNG mask (transparent where you paint).</li>
          <li>Infer intent (remove / replace / generate) from your prompt.</li>
          <li>Call OpenAI Images Edit (or your serverless) and open result back.</li>
        </ul>
      </details>
    </footer>
  </div>
  <script type="module" src="script.js"></script>
</body>
</html>